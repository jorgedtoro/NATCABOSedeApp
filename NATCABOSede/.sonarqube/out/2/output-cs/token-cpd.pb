²
UG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\ViewModels\DatosKpiViewModel.cs
	namespace 	
NATCABOSede
 
. 

ViewModels  
{ 
public 

class 
DatosKpiViewModel "
{ 
public 
string 
Cliente 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Producto 
{  
get! $
;$ %
set& )
;) *
}+ ,
public

 
double

 
PPM

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
public 
double 
PM 
{ 
get 
; 
set  #
;# $
}% &
public 
double 
	ExtraPeso 
{  !
get" %
;% &
set' *
;* +
}, -
public 
double 
CosteMOD 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 

HoraInicio "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
DateTime 
HoraFinAproximada )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
double 
PorcentajePedido &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ¿,
LG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Services\KPIService.cs
	namespace 	
NATCABOSede
 
. 
Services 
{ 
public 

class 

KPIService 
{ 
public 
double 
CalcularPPM !
(! "
double" (
paquetesTotales) 8
,8 9
double: @
minutosTrabajadosA R
,R S
intT W
numeroPersonasX f
)f g
{ 	
if		 
(		 
minutosTrabajados		 !
<=		" $
$num		% &
||		' )
numeroPersonas		* 8
<=		9 ;
$num		< =
)		= >
throw

 
new

 
ArgumentException

 +
(

+ ,
$str

, s
)

s t
;

t u
return 
paquetesTotales "
/# $
(% &
minutosTrabajados& 7
*8 9
numeroPersonas: H
)H I
;I J
} 	
public 
double 

CalcularPM  
(  !
double! '
paquetesTotales( 7
,7 8
double9 ?
minutosTrabajados@ Q
)Q R
{ 	
if 
( 
minutosTrabajados !
<=" $
$num% &
)& '
throw 
new 
ArgumentException +
(+ ,
$str, [
)[ \
;\ ]
return 
paquetesTotales "
/# $
minutosTrabajados% 6
;6 7
} 	
public 
double 
CalcularExtrapeso '
(' (
double( .
pesoReal/ 7
,7 8
double9 ?
pesoObjetivo@ L
)L M
{ 	
return 
pesoReal 
- 
pesoObjetivo *
;* +
} 	
public 
double 
CalcularFTT !
(! "
int" %
paquetesTotales& 5
,5 6
int7 :
paquetesRechazados; M
)M N
{ 	
if 
( 
paquetesTotales 
<=  "
$num# $
)$ %
return 
$num 
; 
return!! 
(!! 
(!! 
double!! 
)!! 
(!! 
paquetesTotales!! ,
-!!- .
paquetesRechazados!!/ A
)!!A B
/!!C D
paquetesTotales!!E T
)!!T U
*!!V W
$num!!X [
;!![ \
}"" 	
public$$ 
DateTime$$ 
GetHoraInicioLote$$ )
($$) *
DateTime$$* 2

horaInicio$$3 =
)$$= >
{%% 	
return&& 

horaInicio&& 
;&& 
}'' 	
public** 
DateTime** 
CalcularHoraFin** '
(**' (
DateTime**( 0

horaInicio**1 ;
,**; <
int**= @
paquetesProducidos**A S
,**S T
double**U ["
mediaPaquetesPorMinuto**\ r
)**r s
{++ 	
if,, 
(,, "
mediaPaquetesPorMinuto,, &
<=,,' )
$num,,* +
),,+ ,
throw-- 
new-- 
ArgumentException-- +
(--+ ,
$str--, a
)--a b
;--b c
double// 
minutosRestantes// #
=//$ %
paquetesProducidos//& 8
///9 :"
mediaPaquetesPorMinuto//; Q
;//Q R
return00 

horaInicio00 
.00 

AddMinutes00 (
(00( )
minutosRestantes00) 9
)009 :
;00: ;
}11 	
public44 
double44 $
CalcularPorcentajePedido44 .
(44. /
int44/ 2
paquetesProducidos443 E
,44E F
int44G J
paquetesTotales44K Z
)44Z [
{55 	
if66 
(66 
paquetesTotales66 
<=66  "
$num66# $
)66$ %
throw77 
new77 
ArgumentException77 +
(77+ ,
$str77, ]
)77] ^
;77^ _
return99 
(99 
double99 
)99 
paquetesProducidos99 -
/99. /
paquetesTotales990 ?
*99@ A
$num99B E
;99E F
}:: 	
publicDD 
doubleDD 
CalcularCosteMODDD &
(DD& '
doubleDD' -
tiempoTotalDD. 9
,DD9 :
doubleDD; A
	costoHoraDDB K
,DDK L
intDDM P
numeroPaquetesDDQ _
,DD_ `
doubleDDa g

pesoMinimoDDh r
)DDr s
{EE 	
ifFF 
(FF 
tiempoTotalFF 
<=FF 
$numFF  
||FF! #
	costoHoraFF$ -
<=FF. 0
$numFF1 2
||FF3 5
numeroPaquetesFF6 D
<=FFE G
$numFFH I
||FFJ L

pesoMinimoFFM W
<=FFX Z
$numFF[ \
)FF\ ]
throwGG 
newGG 
ArgumentExceptionGG +
(GG+ ,
$strGG, V
)GGV W
;GGW X
doubleII 

totalCostoII 
=II 
tiempoTotalII  +
*II, -
	costoHoraII. 7
;II7 8
doubleJJ 
totalProduccionJJ "
=JJ# $
numeroPaquetesJJ% 3
*JJ4 5

pesoMinimoJJ6 @
;JJ@ A
returnLL 

totalCostoLL 
/LL 
totalProduccionLL  /
;LL/ 0
}MM 	
}NN 
}OO –
@G:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder

 
.

 
Services

 
.

 
AddDbContext

 
<

 
NATCABOSede

 )
.

) *
Models

* 0
.

0 1
NATCABOContext

1 ?
>

? @
(

@ A
options

A H
=>

I K
options 
. 
UseSqlServer 
( 
builder  
.  !
Configuration! .
.. /
GetConnectionString/ B
(B C
$strC V
)V W
)W X
)X Y
;Y Z
builder 
. 
Services 
. 
	AddScoped 
< 
NATCABOSede &
.& '
Services' /
./ 0

KPIService0 :
>: ;
(; <
)< =
;= >
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
! 
app 
. 	
Environment	 
. 
IsDevelopment "
(" #
)# $
)$ %
{ 
app 
. 
UseExceptionHandler 
( 
$str )
)) *
;* +
app 
. 
UseHsts 
( 
) 
; 
} 
app 
. 
UseHttpsRedirection 
( 
) 
; 
app 
. 
UseStaticFiles 
( 
) 
; 
app 
. 

UseRouting 
( 
) 
; 
app   
.   
UseAuthorization   
(   
)   
;   
app"" 
."" 
UseEndpoints"" 
("" 
	endpoints"" 
=>"" 
{## 
	endpoints%% 
.%% 
MapControllerRoute%%  
(%%  !
name&& 
:&& 
$str&& 
,&& 
pattern'' 
:'' 
$str'' G
)''G H
;''H I
	endpoints** 
.** 
MapControllerRoute**  
(**  !
name++ 
:++ 
$str++ 
,++ 
pattern,, 
:,, 
$str,, 9
),,9 :
;,,: ;
}-- 
)-- 
;-- 
app// 
.// 
Run// 
(// 
)// 	
;//	 
š
NG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Models\NATCABOContext.cs
	namespace 	
NATCABOSede
 
. 
Models 
; 
public 
partial 
class 
NATCABOContext #
:$ %
	DbContext& /
{ 
public		 

NATCABOContext		 
(		 
)		 
{

 
} 
public 

NATCABOContext 
( 
DbContextOptions *
<* +
NATCABOContext+ 9
>9 :
options; B
)B C
: 	
base
 
( 
options 
) 
{ 
} 
public 

virtual 
DbSet 
< 
DatosKpi !
>! "
	DatosKpis# ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 

virtual 
DbSet 
< 
Linea 
> 
Lineas  &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
	protected 
override 
void 
OnConfiguring )
() *#
DbContextOptionsBuilder* A
optionsBuilderB P
)P Q
=> 

optionsBuilder 
. 
UseSqlServer &
(& '
$str	' —
)
— ˜
;
˜ ™
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
modelBuilder9 E
)E F
{ 
modelBuilder 
. 
Entity 
< 
DatosKpi $
>$ %
(% &
entity& ,
=>- /
{ 	
entity 
. 
Property 
( 
e 
=>  
e! "
." #
Id# %
)% &
.& '
ValueGeneratedNever' :
(: ;
); <
;< =
entity 
. 
Property 
( 
e 
=>  
e! "
." #

IdProducto# -
)- .
.. /
IsFixedLength/ <
(< =
)= >
;> ?
}   	
)  	 

;  
 
modelBuilder"" 
."" 
Entity"" 
<"" 
Linea"" !
>""! "
(""" #
entity""# )
=>""* ,
{## 	
entity$$ 
.$$ 
Property$$ 
($$ 
e$$ 
=>$$  
e$$! "
.$$" #
Id$$# %
)$$% &
.$$& '
ValueGeneratedNever$$' :
($$: ;
)$$; <
;$$< =
}%% 	
)%%	 

;%%
 "
OnModelCreatingPartial'' 
('' 
modelBuilder'' +
)''+ ,
;'', -
}(( 
partial** 
void** "
OnModelCreatingPartial** '
(**' (
ModelBuilder**( 4
modelBuilder**5 A
)**A B
;**B C
}++ ñ
VG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Models\Metadata\Linea.partial.cs
	namespace 	
NATCABOSede
 
. 
Models 
. 
Metadata %
{ 
[ 
MetadataType 
( 
typeof 
( 
LineaMetadata &
)& '
)' (
]( )
public 

partial 
class 
Linea 
{ 
} 
public		 

class		 
LineaMetadata		 
{

 
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Display	 
( 
Name 
= 
$str )
)) *
]* +
public 
int 
NumeroLinea 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Display	 
( 
Name 
= 
$str )
)) *
]* +
public 
string 
NombreLinea !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
null2 6
!6 7
;7 8
} 
} ®
YG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Models\Metadata\DatosKpi.partial.cs
	namespace 	
NATCABOSede
 
. 
Models 
. 
Metadata %
{ 
[ 
MetadataType 
( 
typeof 
( 
DatosKpiMetadata )
)) *
)* +
]+ ,
public 

partial 
class 
DatosKpi !
{ 
} 
public		 

class		 
DatosKpiMetadata		 !
{

 
[ 	
Display	 
( 
Name 
= 
$str 
) 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	
Display	 
( 
Name 
= 
$str 
)  
]  !
public 
int 
IdLinea 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str !
)! "
]" #
public 
int 
? 
	IdCliente 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Display	 
( 
Name 
= 
$str "
)" #
]# $
public 
string 
? 

IdProducto !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Display	 
( 
Name 
= 
$str -
)- .
]. /
public 
double 
? 
PaquetesTrabajados )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} ”
EG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Models\Linea.cs
	namespace 	
NATCABOSede
 
. 
Models 
; 
public		 
partial		 
class		 
Linea		 
{

 
[ 
Key 
] 	
[ 
Column 
( 
$str 
) 
] 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

int 
NumeroLinea 
{ 
get  
;  !
set" %
;% &
}' (
[ 
StringLength 
( 
$num 
) 
] 
public 

string 
NombreLinea 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
null. 2
!2 3
;3 4
} ª
NG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Models\ErrorViewModel.cs
	namespace 	
NATCABOSede
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 ß*
HG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Models\DatosKpi.cs
	namespace 	
NATCABOSede
 
. 
Models 
; 
[		 
Table		 
(		 
$str		 
)		 
]		 
public

 
partial

 
class

 
DatosKpi

 
{ 
[ 
Key 
] 	
[ 
Column 
( 
$str 
) 
] 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
[ 
Column 
( 
$str 
) 
] 
public 

int 
IdLinea 
{ 
get 
; 
set !
;! "
}# $
[ 
Column 
( 
$str 
) 
] 
public 

int 
? 
	IdCliente 
{ 
get 
;  
set! $
;$ %
}& '
[ 
Column 
( 
$str 
) 
] 
[ 
StringLength 
( 
$num 
) 
] 
public 

string 
? 

IdProducto 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Column 
( 
$str  
)  !
]! "
public 

double 
? 
PaquetesTrabajados %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 
Column 
( 
$str 
)  
]  !
public 

double 
? 
MinutosTrabajados $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[   
Column   
(   
$str   
)   
]   
public!! 

int!! 
?!! 
NumeroPersonas!! 
{!!  
get!!! $
;!!$ %
set!!& )
;!!) *
}!!+ ,
[## 
Column## 
(## 
$str## 
)## 
]## 
public$$ 

double$$ 
?$$ 
PesoReal$$ 
{$$ 
get$$ !
;$$! "
set$$# &
;$$& '
}$$( )
[&& 
Column&& 
(&& 
$str&& 
)&& 
]&& 
public'' 

double'' 
?'' 
PesoObjetivo'' 
{''  !
get''" %
;''% &
set''' *
;''* +
}'', -
[)) 
Column)) 
()) 
$str)) 
))) 
])) 
public** 

double** 
?** 
PaquetesTotales** "
{**# $
get**% (
;**( )
set*** -
;**- .
}**/ 0
[,, 
Column,, 
(,, 
$str,,  
),,  !
],,! "
public-- 

double-- 
?-- 
PaquetesRechazados-- %
{--& '
get--( +
;--+ ,
set--- 0
;--0 1
}--2 3
[// 
Column// 
(// 
$str// 
,// 
TypeName// "
=//# $
$str//% /
)/// 0
]//0 1
public00 

DateTime00 
?00 

HoraInicio00 
{00  !
get00" %
;00% &
set00' *
;00* +
}00, -
[22 
Column22 
(22 
$str22 $
)22$ %
]22% &
public33 

double33 
?33 "
MediaPaquetesPorMinuto33 )
{33* +
get33, /
;33/ 0
set331 4
;334 5
}336 7
[55 
Column55 
(55 
$str55 
)55 
]55 
public66 

double66 
?66 
TiempoTotal66 
{66  
get66! $
;66$ %
set66& )
;66) *
}66+ ,
[88 
Column88 
(88 
$str88 
)88 
]88 
public99 

double99 
?99 
	CosteHora99 
{99 
get99 "
;99" #
set99$ '
;99' (
}99) *
[;; 
Column;; 
(;; 
$str;; 
);; 
];; 
public<< 

int<< 
?<< 
NumeroPaquetes<< 
{<<  
get<<! $
;<<$ %
set<<& )
;<<) *
}<<+ ,
[>> 
Column>> 
(>> 
$str>> 
)>> 
]>> 
public?? 

double?? 
??? 

PesoMinimo?? 
{?? 
get??  #
;??# $
set??% (
;??( )
}??* +
[AA 
ColumnAA 
(AA 
$strAA  
)AA  !
]AA! "
publicBB 

doubleBB 
?BB 
PaquetesProducidosBB %
{BB& '
getBB( +
;BB+ ,
setBB- 0
;BB0 1
}BB2 3
}CC ï
SG:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Controllers\HomeController.cs
	namespace 	
NATCABOSede
 
. 
Controllers !
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private		 
readonly		 
ILogger		  
<		  !
HomeController		! /
>		/ 0
_logger		1 8
;		8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Privacy $
($ %
)% &
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
}   –Z
^G:\gitPersonal\NATCABOSedeApp\NATCABOSede\NATCABOSede\Areas\KPIS\Controllers\KPISController.cs
	namespace 	
NATCABOSede
 
. 
Areas 
. 
KPIS  
.  !
Controllers! ,
{ 
[ 
Area 	
(	 

$str
 
) 
] 
public		 

class		 
KPISController		 
:		  !

Controller		" ,
{

 
private 
readonly 
NATCABOContext '
_context( 0
;0 1
private 
readonly 

KPIService #
_kpiService$ /
;/ 0
public 
KPISController 
( 
NATCABOContext ,
context- 4
,4 5

KPIService6 @

kpiServiceA K
)K L
{ 	
_context 
= 
context 
; 
_kpiService 
= 

kpiService $
;$ %
} 	
public 
IActionResult 
Index "
(" #
int# &
lineaSeleccionada' 8
=9 :
$num; <
)< =
{ 	
ViewBag 
. 
LineaSeleccionada %
=& '
lineaSeleccionada( 9
;9 :
var 
datos 
=  
ObtenerDatosPorLinea ,
(, -
lineaSeleccionada- >
)> ?
;? @
if 
( 
datos 
== 
null 
) 
{ 
return 
NotFound 
(  
$str  U
)U V
;V W
} 
var 
ppm 
= 
_kpiService !
.! "
CalcularPPM" -
(- .
datos 
. 
PaquetesTrabajados (
??) +
$num, -
,- .
datos   
.   
MinutosTrabajados   '
??  ( *
$num  + ,
,  , -
datos!! 
.!! 
NumeroPersonas!! $
??!!% '
$num!!( )
)!!) *
;!!* +
var## 
pm## 
=## 
_kpiService##  
.##  !

CalcularPM##! +
(##+ ,
datos$$ 
.$$ 
PaquetesTrabajados$$ (
??$$) +
$num$$, -
,$$- .
datos%% 
.%% 
MinutosTrabajados%% '
??%%( *
$num%%+ ,
)%%, -
;%%- .
var'' 
	extraPeso'' 
='' 
_kpiService'' '
.''' (
CalcularExtrapeso''( 9
(''9 :
datos(( 
.(( 
PesoReal(( 
??(( !
$num((" #
,((# $
datos)) 
.)) 
PesoObjetivo)) "
??))# %
$num))& '
)))' (
;))( )
var++ 
horaFinAproximada++ !
=++" #
_kpiService++$ /
.++/ 0
CalcularHoraFin++0 ?
(++? @
datos,, 
.,, 

HoraInicio,,  
??,,! #
DateTime,,$ ,
.,,, -
Now,,- 0
,,,0 1
(-- 
int-- 
)-- 
(-- 
datos-- 
.-- 
PaquetesTotales-- +
---, -
datos--. 3
.--3 4
PaquetesProducidos--4 F
??--G I
$num--J K
)--K L
,--L M
datos.. 
... "
MediaPaquetesPorMinuto.. ,
??..- /
$num..0 1
)..1 2
;..2 3
var00 
porcentajePedido00  
=00! "
_kpiService00# .
.00. /$
CalcularPorcentajePedido00/ G
(00G H
(11 
int11 
)11 
(11 
datos11 
.11 
PaquetesProducidos11 .
??11/ 1
$num112 3
)113 4
,114 5
(22 
int22 
)22 
(22 
datos22 
.22 
PaquetesTotales22 +
??22, .
$num22/ 0
)220 1
)221 2
;222 3
var44 
costeMOD44 
=44 
_kpiService44 &
.44& '
CalcularCosteMOD44' 7
(447 8
datos55 
.55 
TiempoTotal55 !
??55" $
$num55% &
,55& '
datos66 
.66 
	CosteHora66 
??66  "
$num66# $
,66$ %
datos77 
.77 
NumeroPaquetes77 $
??77% '
$num77( )
,77) *
datos88 
.88 

PesoMinimo88  
??88! #
$num88$ %
)88% &
;88& '
var__ 
modelo__ 
=__ 
new__ 
DatosKpiViewModel__ .
{`` 
Clienteaa 
=aa 
$straa .
,aa. /
Productobb 
=bb 
$strbb 0
,bb0 1
PPMcc 
=cc 
ppmcc 
,cc 
PMdd 
=dd 
pmdd 
,dd 
	ExtraPesoee 
=ee 
	extraPesoee %
,ee% &

HoraInicioff 
=ff 
datosff "
.ff" #

HoraInicioff# -
??ff. 0
DateTimeff1 9
.ff9 :
Nowff: =
,ff= >
HoraFinAproximadagg !
=gg" #
horaFinAproximadagg$ 5
,gg5 6
PorcentajePedidohh  
=hh! "
porcentajePedidohh# 3
,hh3 4
CosteMODii 
=ii 
costeMODii #
}jj 
;jj 
returnll 
Viewll 
(ll 
modeloll 
)ll 
;ll  
}mm 	
publicnn 
IActionResultnn 
ObtenerKPIsnn (
(nn( )
intnn) ,
lineaSeleccionadann- >
)nn> ?
{oo 	
varqq 
datosqq 
=qq  
ObtenerDatosPorLineaqq ,
(qq, -
lineaSeleccionadaqq- >
)qq> ?
;qq? @
ifss 
(ss 
datosss 
==ss 
nullss 
)ss 
{tt 
returnuu 
NotFounduu 
(uu  
$struu  U
)uuU V
;uuV W
}vv 
varww 
ppmww 
=ww 
_kpiServiceww !
.ww! "
CalcularPPMww" -
(ww- .
datosxx 
.xx 
PaquetesTrabajadosxx (
??xx) +
$numxx, -
,xx- .
datosyy 
.yy 
MinutosTrabajadosyy '
??yy( *
$numyy+ ,
,yy, -
datoszz 
.zz 
NumeroPersonaszz $
??zz% '
$numzz( )
)zz) *
;zz* +
var|| 
pm|| 
=|| 
_kpiService||  
.||  !

CalcularPM||! +
(||+ ,
datos}} 
.}} 
PaquetesTrabajados}} (
??}}) +
$num}}, -
,}}- .
datos~~ 
.~~ 
MinutosTrabajados~~ '
??~~( *
$num~~+ ,
)~~, -
;~~- .
var
€€ 
	extraPeso
€€ 
=
€€ 
_kpiService
€€ '
.
€€' (
CalcularExtrapeso
€€( 9
(
€€9 :
datos
 
.
 
PesoReal
 
??
 !
$num
" #
,
# $
datos
‚‚ 
.
‚‚ 
PesoObjetivo
‚‚ "
??
‚‚# %
$num
‚‚& '
)
‚‚' (
;
‚‚( )
var
„„ 
horaFinAproximada
„„ !
=
„„" #
_kpiService
„„$ /
.
„„/ 0
CalcularHoraFin
„„0 ?
(
„„? @
datos
…… 
.
…… 

HoraInicio
……  
??
……! #
DateTime
……$ ,
.
……, -
Now
……- 0
,
……0 1
(
†† 
int
†† 
)
†† 
(
†† 
datos
†† 
.
†† 
PaquetesTotales
†† +
-
††, -
datos
††. 3
.
††3 4 
PaquetesProducidos
††4 F
??
††G I
$num
††J K
)
††K L
,
††L M
datos
‡‡ 
.
‡‡ $
MediaPaquetesPorMinuto
‡‡ ,
??
‡‡- /
$num
‡‡0 1
)
‡‡1 2
;
‡‡2 3
var
‰‰ 
porcentajePedido
‰‰  
=
‰‰! "
_kpiService
‰‰# .
.
‰‰. /&
CalcularPorcentajePedido
‰‰/ G
(
‰‰G H
(
ŠŠ 
int
ŠŠ 
)
ŠŠ 
(
ŠŠ 
datos
ŠŠ 
.
ŠŠ  
PaquetesProducidos
ŠŠ .
??
ŠŠ/ 1
$num
ŠŠ2 3
)
ŠŠ3 4
,
ŠŠ4 5
(
‹‹ 
int
‹‹ 
)
‹‹ 
(
‹‹ 
datos
‹‹ 
.
‹‹ 
PaquetesTotales
‹‹ +
??
‹‹, .
$num
‹‹/ 0
)
‹‹0 1
)
‹‹1 2
;
‹‹2 3
var
 
costeMOD
 
=
 
_kpiService
 &
.
& '
CalcularCosteMOD
' 7
(
7 8
datos
ŽŽ 
.
ŽŽ 
TiempoTotal
ŽŽ !
??
ŽŽ" $
$num
ŽŽ% &
,
ŽŽ& '
datos
 
.
 
	CosteHora
 
??
  "
$num
# $
,
$ %
datos
 
.
 
NumeroPaquetes
 $
??
% '
$num
( )
,
) *
datos
‘‘ 
.
‘‘ 

PesoMinimo
‘‘  
??
‘‘! #
$num
‘‘$ %
)
‘‘% &
;
‘‘& '
var
”” 
modelo
”” 
=
”” 
new
”” 
DatosKpiViewModel
”” .
{
•• 
Cliente
–– 
=
–– 
$str
–– .
,
––. /
Producto
—— 
=
—— 
$str
—— 0
,
——0 1
PPM
˜˜ 
=
˜˜ 
ppm
˜˜ 
,
˜˜ 
PM
™™ 
=
™™ 
pm
™™ 
,
™™ 
	ExtraPeso
šš 
=
šš 
	extraPeso
šš %
,
šš% &

HoraInicio
›› 
=
›› 
datos
›› "
.
››" #

HoraInicio
››# -
??
››. 0
DateTime
››1 9
.
››9 :
Now
››: =
,
››= >
HoraFinAproximada
œœ !
=
œœ" #
horaFinAproximada
œœ$ 5
,
œœ5 6
PorcentajePedido
  
=
! "
porcentajePedido
# 3
,
3 4
CosteMOD
žž 
=
žž 
costeMOD
žž #
}
ŸŸ 
;
ŸŸ 
return
¡¡ 
PartialView
¡¡ 
(
¡¡ 
$str
¡¡ -
,
¡¡- .
modelo
¡¡/ 5
)
¡¡5 6
;
¡¡6 7
}
¢¢ 	
private
££ 
DatosKpi
££ "
ObtenerDatosPorLinea
££ -
(
££- .
int
££. 1
linea
££2 7
)
££7 8
{
¤¤ 	
var
¥¥ 
datosKPI
¥¥ 
=
¥¥ 
_context
¥¥ #
.
¥¥# $
	DatosKpis
¥¥$ -
.
¦¦ 
FirstOrDefault
¦¦ 
(
¦¦ 
d
¦¦ 
=>
¦¦  
d
¦¦! "
.
¦¦" #
IdLinea
¦¦# *
==
¦¦+ -
linea
¦¦. 3
)
¦¦3 4
;
¦¦4 5
return
¨¨ 
datosKPI
¨¨ 
;
¨¨ 
}
©© 	
}
ªª 
}­­ 